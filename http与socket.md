# MVC

>  模型-视图-控制器模式，也称为MVC模式（Model View Controller）。 

- **模型（Model）**：负责存储系统的中心数据。

`  模型只关注对数据的交互部分，数据更改，只要该模型的部分就行。 `

- **视图（View）**：将信息显示给用户（可以定义多个视图）。

`  视图关注的是跟用户进行交互的代码段 ` 

>  按照正常情况，视图不应该处理数据，然而在实际过程中，由于业务逻辑的日益变得复杂，在某种无关紧要的逻辑的更改，在核心部分修改源码反而很麻烦，所以往往可能会在view层写一些无关痛痒的处理逻辑 

- **控制器（Controller）**：处理用户输入的信息。负责从视图读取数据，控制用户输入，并向模型发送数据，是应用程序中处理用户交互的部分。负责管理与用户交互交互控制。

`   control 就是控制视图和模型之间的数据交互机制和通信 ` 

#### 特点：

##### MVC重要特点就是两种分离：

　　1. **视图和数据模型的分离**：使用不同的视图对相同的数据进行展示；分离可视和不可视的组件，能够对模型进行独立测试。因为分离了可视组件减少了外部依赖利于测试。（数据库也是一种外部组件）

　　2. **视图和表现逻辑(Controller)的分离**：Controller是一个表现逻辑的组件，并非一个业务逻辑组件。MVC可以作为表现模式也可以作为建构模式，意味这Controller也可以是业务逻辑。分离逻辑和具体展示，能够对逻辑进行独立测试。

**优点**：耦合性低；重用性高；生命周期成本低；部署块；可维护性高；有利软件工程化管理。

**缺点**：没有明确的定义；不适合小型，中等规模的应用程序；增加系统结构和实现的复用性；视图与控制器间的过于紧密的连接；视图对模型数据的低效率访问；一般高级的界面工具或构造器不支持模式。

# HTTP

#### TCP

[TCP报文结构](https://www.cnblogs.com/kaleidoscope/p/9701117.html)

![img](https://img2018.cnblogs.com/blog/184881/201809/184881-20180925182219599-1893425143.png)

TCP是面向连接的通讯协议，通过三次握手建立连接，四次挥手完成通讯

>位码即tcp标志位，有6种标示：SYN(synchronous建立联机) ACK(acknowledgement 确认) PSH(push传送) FIN(finish结束) RST(reset重置) URG(urgent紧急)Sequence number(顺序号码) Acknowledge number(确认号码)

三次握手和四次挥手

>**三次握手**：是指在建立一个TCP连接时，需要客户端和服务端总共发送三个包
>1.第一次握手：客户端发送一个TCP的SYN标志位1的包指明客户端打算连接服务端，并发送初始序号X
>2.第二次握手：服务器发回确认包（ACK）应答，即SYN和ACK标志位都为1时，将 确认序号设置为X+1
>3.第三次握手：客户端再次发送确认包（ACK）SYN标志位为0，ACK标志位为1，并且把服务器发来ACK的序号字段+1，放在确认字段中发送给服务端

  >**四次挥手**：TCP的连接拆除需要发送四个包，客户端和服务端均可主动发起挥手动作
  >  1.主动方发送Fin+Ack报文，并发送序号X，请求通信关闭
  >  2.被动方发送ACK报文，并置发送序号为Z，确认序号为X+1，答应你关闭通信
  >  3.被动方发送Fin+Ack报文，并置发送序号为Y，确认序号为X，也请求关闭通信
  >  4.主动方发送ack报文，并发送序号为X，确认序号为Y，也答应关闭通信

- 优点： 
  TCP在数据传递时，有确认、窗口、重传、阻塞等控制机制，能保证数据正确性，较为可靠
- 缺点：
  TCP相对UDP速度慢一点，要求系统资源较多

#### [关于4次挥手时等待2MSL的问题 ](https://blog.csdn.net/q846169253/article/details/82217910 )

1. 为什么不直接关闭要进入等待状态？

​            ` 1.保证客户端发送的ACK报文段能够到达服务器，从而保证tcp连接能够进行可靠的关闭。 ` 

​			`  2.保证此次连接的数据段消失，防止失效的数据段。  ` 

2. 为什么等待的时间是2MSL？

   >我们知道服务端收到ACK，关闭连接。但是客户端无法知道ACK是否已经到达服务端，于是开始等待？等待什么呢？假如ACK没有到达服务端，服务端会为FIN这个消息超时重传 timeout retransmit ，那如果客户端等待时间足够，又收到FIN消息，说明ACK没有到达服务端，于是再发送ACK，直到在足够的时间内没有收到FIN，说明ACK成功到达。这个等待时间至少是：服务端的timeout + FIN的传输时间，为了保证可靠，采用更加保守的等待时间2MSL

    `  MSL，Maximum Segment Life，这是TCP 对TCP Segment 生存时间的限制。 ` 

#### UDP

UDP是面向无连接，且不安全的协议，在通信过程中，它并不像TCP那样需要先建立一个连接，只要目的端口号和源端口号确定了， 就能直接发送信息报文，它只提供校验机制来保证报文的完整性，若校验失败，则直接丢报文，不做任何处理。


- 优点：
  UDP速度快，操作简单。要求系统资源较少，由于通讯不需要连接，可以实现广播发送
- 缺点：
  UDP传输数据前不创建连接，直接发送数据，接收端不确定一定能接收到完整数据，不可靠

QQ客户端之间的消息传送也采用了UDP模式, 腾讯采用了上层协议来保证可靠传输：如果客户端使用UDP协议发出消息后，服务器收到该包，需要使用UDP协议发回一个应答包。如此来保证消息可以无遗漏传输。之所以会发生在客户端明明看到“消息发送失败”但对方又收到了这个消息的情况，就是因为客户端发出的消息服务器已经收到并转发成功，但客户端由于网络原因没有收到服务器的应答包引起的。https://www.jianshu.com/p/384abfe83892

#### 选择

TCP一般用于文件传输，邮件接发，远程登陆

UDP一般用于在线视频，网络电话

#### HTTPS 和 HTTP 的区别

1、https 协议需要到 ca 申请证书，一般免费证书较少，因而需要一定费用。
2、http 是超文本传输协议，信息是明文传输，https 则是具有安全性的 ssl 加密传输协议。
3、http 和 https 使用的是完全不同的连接方式，用的端口也不一样，前者是 80，后者是 443。
4、http 的连接很简单，是无状态的;HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 http 协议安全。

# uWSGI

- 生产部署，环境部署

##### uWSGI的理解

  >1.uWSGI 是一个 Web 服务器，它实现了 WSGI 协议、uwsgi、http 等协议。Nginx 中	HttpUwsgiModule 的作用是与 uWSGI 服务器进行交换。WSGI 是一种 Web 服务器网关	接口。它是一 个 Web 服务器(如 nginx，uWSGI 等服务器)与 web 应用(如用 Flask 框架写的程序)通信的一种 规范。

##### WSGI / uwsgi / uWSGI 这三个概念的区分

>WSGI 是一种通信协议。
>uwsgi 是一种线路协议而不是通信协议，在此常用于在 uWSGI 服务器与其他网络服务器的数据通信。
>
>uWSGI 是实现了 uwsgi 和 WSGI 两种协议的 Web 服务器。

##### Nginx的理解

  - nginx 是一个开源的高性能的 HTTP 服务器和反向代理

  - 作为 web 服务器，它处理静态文件和索引文件效果非常高

  - 它的设计非常注重效率，最大支持 5 万个并发连接，但只占用很少的内存空间

  - 稳定性高，配置简洁

  - 强大的反向代理和负载均衡功能，平衡集群中各个服务器的负载压力应用

- nginx 和 uWISG 服务器之间如何配合工作

  >首先浏览器发起 http 请求到 nginx 服务器，Nginx 根据接收到请求包，进行 url 分析，判断访问的 资源类型，如果是静态资源，直接读取静态资源返回给浏览器，如果请求的是动态资源就转交给 uwsgi服务器，uwsgi 服务器根据自身的 uwsgi 和 WSGI 协议，找到对应的 Django 框架，Django 框架下的 应用进行逻辑处理后，将返回值发送到 uwsgi 服务器，然后 uwsgi 服务器再返回给 nginx，最后 nginx将返回值返回给浏览器进行渲染显示给用户。
  >
  >

- nginx负载均衡保持session会话一致

  >负载均衡时，为了保证同一用户session会被分配到同一台服务器上，可以使用以下方法：
  >
  >1.使用cookie将用户的session存入cookie里，当用户分配到不同的服务器时，先判断服务器是否存在该用户的session，如果没有就先把cookie里面的sessoin存入该服务器，实现session会话保持。缺点是存入cookie有安全隐患。
  >
  >2.使用缓存利用memcache，Redis等缓存分布式的特点，可以将所有服务器产生的session存入同一台服务器的缓存中，实现session共享。这样安全性比较高，而且从内存中读取session比从文件中读取速度快。
  >
  >3.使用ip_hash如果是nginx服务器的负载均衡，可以在upstream里设置ip_hash，每个请求按访问ip的hash结果分配，映射到固定某一台的服务器。缺点是可能导致负载不均衡，不适合单点登录。

# RESTfull/websocket的API开发



## websocket

![img](https://upload-images.jianshu.io/upload_images/4286978-1b151a9e5e7076ed.png?imageMogr2/auto-orient/strip|imageView2/2/w/340/format/webp)

>上图对比可以看出，相对于传统 HTTP 每次请求-应答都需要客户端与服务端建立连接的模式，WebSocket 是类似 Socket 的 TCP 长连接的通讯模式，一旦 WebSocket 连接建立后，后续数据都以帧序列的形式传输。在客户端断开 WebSocket 连接或 Server 端断掉连接前，不需要客户端和服务端重新发起连接请求。在海量并发及客户端与服务器交互负载流量大的情况下，极大的节省了网络带宽资源的消耗，有明显的性能优势，且客户端发送和接受消息是在同一个持久连接上发起，实时性优势明显。



### 谈谈你对RESTful 规范的认识？

-----------------------

RESTful其实就是一套编写接口的'协议'，规定如何编写以及如何设置返回值、状态码等信息。

##### 最显著的特点：

​    用RESTful：
​     
​        给调用者很多url，每个url代表一个功能，比如：add_user/delte_user/edit_user/
当然，还有协议其他的，比如：
'版本'来控制让程序有多个版本共存的情况，版本可以放在 url、请求头
（accept/自定义）、GET参数
'状态码'200/300/400/500
​    200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。
​    400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。
​    404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。
​    500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。

'url中尽量使用名词'restful也可以称为“面向资源编程”
'api标示'
    api.sex.com    尽量将API部署在专用域名（会存在跨域问题）
    www.sex.com/api/     

-------------------------------






